<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Planner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #87CEEB 0%, #4682B4 50%, #191970 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            padding: 20px;
        }

        /* Animated background elements */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
            top: 0;
            left: 0;
            z-index: 0;
        }

        .floating-shape {
            position: absolute;
            opacity: 0.1;
            animation: float 20s infinite linear;
        }

        .floating-shape:nth-child(1) {
            top: 10%;
            left: 20%;
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            animation-delay: -2s;
        }

        .floating-shape:nth-child(2) {
            top: 70%;
            left: 80%;
            width: 120px;
            height: 120px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            animation-delay: -8s;
        }

        .floating-shape:nth-child(3) {
            top: 40%;
            left: 10%;
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 30px;
            animation-delay: -15s;
        }

        .floating-shape:nth-child(4) {
            top: 20%;
            left: 70%;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 50%;
            animation-delay: -5s;
        }

        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
            100% { transform: translateY(0px) rotate(360deg); }
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }

        .form-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 3rem 2.5rem;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.1);
            animation: slideIn 1.2s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        h1 {
            text-align: center;
            color: #bde9faff;
            margin-bottom: 2rem;
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 900;
            animation: titleGlow 3s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            from {
                filter: drop-shadow(0 0 20px rgba(200, 230, 255, 0.4));
            }
            to {
                filter: drop-shadow(0 0 40px rgba(200, 230, 255, 0.7));
            }
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        /* Conditional form group with smooth transitions */
        .form-group.conditional {
            transition: all 0.3s ease;
            opacity: 1;
            max-height: 200px;
            overflow: hidden;
        }

        .form-group.conditional.hidden {
            opacity: 0;
            max-height: 0;
            margin-bottom: 0;
            pointer-events: none;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: white;
            font-size: 1rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: rgba(135, 206, 235, 0.8);
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 0 0 3px rgba(135, 206, 235, 0.2);
            transform: translateY(-2px);
        }

        textarea {
            height: 120px;
            resize: vertical;
        }

        button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 15px 30px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            backdrop-filter: blur(15px);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            margin-top: 1rem;
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s;
        }

        button:hover::before {
            left: 100%;
        }

        button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.6);
        }

        button:active {
            transform: translateY(-1px);
        }

        /* Flash message styles */
        .flash-messages {
            margin-bottom: 2rem;
        }

        .flash-message {
            padding: 16px 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            font-weight: 600;
            backdrop-filter: blur(15px);
            border: 1px solid;
            animation: flashSlideIn 0.5s ease-out;
        }

        @keyframes flashSlideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .flash-message.error {
            background: rgba(255, 107, 107, 0.15);
            border-color: rgba(255, 107, 107, 0.4);
            color: #ff6b6b;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.2);
        }

        .flash-message.success {
            background: rgba(78, 205, 196, 0.15);
            border-color: rgba(78, 205, 196, 0.4);
            color: #4ecdc4;
            box-shadow: 0 5px 15px rgba(78, 205, 196, 0.2);
        }

        .flash-message.info {
            background: rgba(135, 206, 235, 0.15);
            border-color: rgba(135, 206, 235, 0.4);
            color: #87CEEB;
            box-shadow: 0 5px 15px rgba(135, 206, 235, 0.2);
        }

        .flash-message.warning {
            background: rgba(255, 193, 7, 0.15);
            border-color: rgba(255, 193, 7, 0.4);
            color: #ffc107;
            box-shadow: 0 5px 15px rgba(255, 193, 7, 0.2);
        }

        .row {
            display: flex;
            gap: 20px;
        }

        .col {
            flex: 1;
        }

        .status {
            text-align: center;
            color: #4ecdc4;
            font-weight: 600;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(78, 205, 196, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(78, 205, 196, 0.3);
        }

        /* Back button styling */
        .back-button {
            display: inline-flex;
            align-items: center;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 500;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* Travel icons at top */
        .travel-icons {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 1rem;
            animation: iconFloat 4s ease-in-out infinite;
        }

        .travel-icons span {
            margin: 0 0.5rem;
            animation: bounce 2s ease-in-out infinite;
        }

        .travel-icons span:nth-child(1) { animation-delay: 0s; }
        .travel-icons span:nth-child(2) { animation-delay: 0.2s; }
        .travel-icons span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes iconFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-8px) scale(1.1); }
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .form-container {
                padding: 2rem 1.5rem;
                margin: 0.5rem;
            }
            
            .row {
                flex-direction: column;
                gap: 0;
            }
            
            .travel-icons {
                font-size: 2rem;
            }
        }

        @media (max-width: 480px) {
            .form-container {
                padding: 1.5rem 1rem;
            }
            
            .travel-icons {
                font-size: 1.5rem;
            }
        }

        hr {
            margin: 30px 0;
            border: none;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <!-- Background animation elements -->
    <div class="bg-animation">
        <div class="floating-shape"></div>
        <div class="floating-shape"></div>
        <div class="floating-shape"></div>
        <div class="floating-shape"></div>
    </div>

    <div class="container">
        <div class="form-container">
            <div class="travel-icons">
                <span>✈️</span>
                <span>🗺️</span>
                <span>🎒</span>
            </div>
            
            <!-- Back button -->
            <div style="text-align: left; margin-bottom: 1rem;">
                <a href="/" class="back-button">
                    ← Back Home
                </a>
            </div>
            
            <h1>Plan Your Perfect Trip</h1>
            
            <!-- Enhanced Flash messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="flash-messages">
                        {% for category, message in messages %}
                            <div class="flash-message {{ category if category else 'info' }}">
                                {% if category == 'error' %}⚠️{% elif category == 'success' %}✅{% elif category == 'warning' %}⚡{% else %}ℹ️{% endif %}
                                {{ message }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}
            
            <!-- FIXED: Form action now points to /planner instead of /submit -->
            <form method="POST" action="/planner">
                <div class="form-group">
                    <label for="user_email">Email Address:</label>
                    <input type="email" id="user_email" name="user_email" required 
                           value="{{ request.form.get('user_email', '') if request.form else '' }}" required placeholder="Please use the same email as your Arcade account!">
                </div>
                
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="start_location">From (City):</label>
                            <input type="text" id="start_location" name="start_location" required placeholder="e.g. New York City"
                                   value="{{ request.form.get('start_location', '') if request.form else '' }}">
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="travel_location">To (City):</label>
                            <input type="text" id="travel_location" name="travel_location" required placeholder="e.g. San Francisco"
                                   value="{{ request.form.get('travel_location', '') if request.form else '' }}">
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="passenger_adult_count">Adults:</label>
                            <input type="number" id="passenger_adult_count" name="passenger_adult_count" min="1" value="{{ request.form.get('passenger_adult_count', '1') if request.form else '1' }}" required>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="passenger_child_count">Children:</label>
                            <input type="number" id="passenger_child_count" name="passenger_child_count" min="0" value="{{ request.form.get('passenger_child_count', '0') if request.form else '0' }}">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="travel_style">Travel Style:</label>
                    <select id="travel_style" name="travel_style" required>
                        <option value="Flying" {{ 'selected' if request.form and request.form.get('travel_style') == 'Flying' else '' }}>Flying</option>
                        <option value="Driving" {{ 'selected' if request.form and request.form.get('travel_style') == 'Driving' else '' }}>Driving</option>
                    </select>
                </div>

                <!-- Travel Class - Only shown when Flying is selected -->
                <div class="form-group conditional" id="travel-class-group">
                    <label for="travel_class">Travel Class:</label>
                    <select id="travel_class" name="travel_class">
                        <option value="ECONOMY" {{ 'selected' if request.form and request.form.get('travel_class') == 'ECONOMY' else '' }}>Economy</option>
                        <option value="PREMIUM_ECONOMY" {{ 'selected' if request.form and request.form.get('travel_class') == 'PREMIUM_ECONOMY' else '' }}>Premium</option>
                        <option value="BUSINESS" {{ 'selected' if request.form and request.form.get('travel_class') == 'BUSINESS' else '' }}>Business</option>
                        <option value="FIRST" {{ 'selected' if request.form and request.form.get('travel_class') == 'FIRST' else '' }}>First</option>
                    </select>
                </div>

                <!-- Car Type - Only shown when Driving is selected -->
                <div class="form-group conditional hidden" id="car-type-group">
                    <label for="car_type">Car Type:</label>
                    <select id="car_type" name="car_type">
                        <option value="Gas" {{ 'selected' if request.form and request.form.get('car_type') == 'Gas' else '' }}>Gas Vehicle</option>
                        <option value="Electric" {{ 'selected' if request.form and request.form.get('car_type') == 'Mid-Electric' else '' }}>Electric Vehicle</option>
                    </select>
                </div>
                
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="arrival_date">Arrival Date:</label>
                            <input type="date" id="arrival_date" name="arrival_date" required
                                   value="{{ request.form.get('arrival_date', '') if request.form else '' }}">
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="departure_date">Departure Date:</label>
                            <input type="date" id="departure_date" name="departure_date" required
                                   value="{{ request.form.get('departure_date', '') if request.form else '' }}">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="travel_preferences">Travel Preferences:</label>
                    <textarea id="travel_preferences" name="travel_preferences" placeholder="Tell us what you'd like to do! e.g. I want to go shopping and see museums">{{ request.form.get('travel_preferences', '') if request.form else '' }}</textarea>
                </div>
                
                <button type="submit">🌟 Plan My Trip</button>
            </form>

            <hr>
        </div>
    </div>
    
    <script>
        // Function to toggle travel class and car type visibility
        function toggleTravelOptions() {
            const travelStyle = document.getElementById('travel_style').value;
            const travelClassGroup = document.getElementById('travel-class-group');
            const travelClassSelect = document.getElementById('travel_class');
            const carTypeGroup = document.getElementById('car-type-group');
            const carTypeSelect = document.getElementById('car_type');
            
            if (travelStyle === 'Flying') {
                // Show travel class, hide car type
                travelClassGroup.classList.remove('hidden');
                travelClassSelect.setAttribute('required', 'required');
                carTypeGroup.classList.add('hidden');
                carTypeSelect.removeAttribute('required');
                carTypeSelect.value = '';
            } else if (travelStyle === 'Driving') {
                // Show car type, hide travel class
                carTypeGroup.classList.remove('hidden');
                carTypeSelect.setAttribute('required', 'required');
                travelClassGroup.classList.add('hidden');
                travelClassSelect.removeAttribute('required');
                travelClassSelect.value = '';
            }
        }
        
        // Set minimum date to today
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('arrival_date').min = today;
        document.getElementById('departure_date').min = today;
        
        // Auto-update departure date when arrival date changes
        document.getElementById('arrival_date').addEventListener('change', function() {
            const arrivalDate = new Date(this.value);
            const nextDay = new Date(arrivalDate);
            nextDay.setDate(nextDay.getDate() + 1);
            document.getElementById('departure_date').min = nextDay.toISOString().split('T')[0];
        });

        // Listen for travel style changes
        document.getElementById('travel_style').addEventListener('change', toggleTravelOptions);
        
        // Initialize the visibility on page load
        document.addEventListener('DOMContentLoaded', function() {
            toggleTravelOptions();
            
            // Auto-dismiss flash messages after 5 seconds
            const flashMessages = document.querySelectorAll('.flash-message');
            flashMessages.forEach(function(message) {
                setTimeout(function() {
                    message.style.opacity = '0';
                    message.style.transform = 'translateY(-10px)';
                    setTimeout(function() {
                        message.remove();
                    }, 300);
                }, 5000);
            });
        });
    </script>
</body>
</html>